<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BashSpark: API Usage explanation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="bs.svg"/></td>
  <td id="projectalign">
   <div id="projectname">BashSpark
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('api_usage.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">API Usage explanation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section provides detailed instructions on how to utilize the BashSpark library effectively. It covers essential operations such as creating a shell instance, initializing a shell session, executing commands, and developing custom commands.</p>
<p>By following these guidelines, developers can manage command execution securely and efficiently while avoiding common pitfalls. The examples included showcase practical implementations, helping users to grasp each concept through hands-on coding snippets. Whether you are new to the library or seeking to enhance your command structures, this section serves as a comprehensive guide for operational success.</p>
<h1><a class="anchor" id="create_shell"></a>
Create a shell instance</h1>
<p>The first step to run commands is to create a shell. This class is named <code><a class="el" href="classbs_1_1shell.html" title="A simplified shell environment inspired by Bash.">bs::shell</a></code>. This class manages the available commands.</p>
<p>This command management method allow the programmer to strictly control the allowed behaviors, preventing security holes. This enhances the safety and reliability of command execution, ensuring that only authorized commands are executed and that errors are handled gracefully.</p>
<p>It is possible to obtain the default shell using method <code>std::unique_ptr&lt;<a class="el" href="classbs_1_1shell.html" title="A simplified shell environment inspired by Bash.">bs::shell</a>&gt; <a class="el" href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9" title="Construct bash object.">bs::shell::make_default_shell()</a></code>. The user may also use the default constructor <code><a class="el" href="classbs_1_1shell.html" title="A simplified shell environment inspired by Bash.">bs::shell()</a></code> to create a custom shell.</p>
<p>The class shell session may have the following methods overridden to change behavior (such as internationalization):</p>
<ul>
<li><code>void shell::msg_error_command_not_found(shell_session &amp;, const std::string &amp;) const</code>: error message on command not found.</li>
<li><code>void shell::msg_error_syntax_error(const shell_session &amp;, const shell_exception &amp;) const</code>: error message on syntax error.</li>
</ul>
<p>Example on obtaining the default session:</p>
<div class="fragment"><div class="line">std::unique_ptr&lt;bs::shell&gt; pShell = <a class="code hl_function" href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9">bs::shell::make_default_shell</a>();</div>
<div class="ttc" id="aclassbs_1_1shell_html_af7bb333ac92bdd0b70fe3da4b22d2bc9"><div class="ttname"><a href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9">bs::shell::make_default_shell</a></div><div class="ttdeci">static std::unique_ptr&lt; shell &gt; make_default_shell()</div><div class="ttdoc">Construct bash object.</div><div class="ttdef"><b>Definition</b> shell.cpp:50</div></div>
</div><!-- fragment --><p>Example on building the default session:</p>
<div class="fragment"><div class="line">std::unique_ptr&lt;shell&gt; shell::make_default_shell() {</div>
<div class="line">    <span class="keyword">auto</span> pShell = std::make_unique&lt;shell&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_echo&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_eval&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_getenv&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_getvar&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_setenv&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_setvar&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_seq&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_test&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_math&gt;();</div>
<div class="line">    pShell-&gt;set_command&lt;command_fcall&gt;();</div>
<div class="line">    <span class="keywordflow">return</span> pShell;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="create_session"></a>
Create a shell session</h1>
<p>In order to execute shell commands a shell session is needed. This class is named <code><a class="el" href="classbs_1_1shell__session.html" title="Represents an execution environment for a shell instance.">bs::shell_session</a></code>. The class <code><a class="el" href="classbs_1_1shell__session.html" title="Represents an execution environment for a shell instance.">bs::shell_session</a></code> contains the streams (stdin, stdout, stderr), the environment variables, the function arguments, the local variables, the last exit status code and the shell depth. See the documentation on <code><a class="el" href="classbs_1_1shell__session.html" title="Represents an execution environment for a shell instance.">bs::shell_session</a></code> for more details.</p>
<p>A <code><a class="el" href="classbs_1_1shell__session.html" title="Represents an execution environment for a shell instance.">bs::shell_session</a></code> is constructed as <code>shell_session(const shell *pShell, std::istream &amp;oStdIn, std::ostream &amp;oStdOut, std::ostream &amp;oStdErr)</code>.</p>
<p>The class <code><a class="el" href="classbs_1_1shell__session.html" title="Represents an execution environment for a shell instance.">bs::shell_session</a></code> may be extended in order to add custom information to the session. If a custom command uses the custom session, on method <code><a class="el" href="classbs_1_1command.html#a62a67df77ffd5e49ef68523bd8c7502a" title="Execute the command.">bs::command::run</a>(const std::span&lt;const std::string&gt; &amp;, shell_session &amp;) const</code>, it will be necessary to use <code>auto pCustomSession = dynamic_cast&lt;shell_session_custom*&gt;(&amp;oSession)</code> in order to acquire it.</p>
<p>Example of shell session directly linked to terminal:</p>
<div class="fragment"><div class="line"><span class="comment">// Generate shell</span></div>
<div class="line">std::unique_ptr&lt;bs::shell&gt; pShell = <a class="code hl_function" href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9">bs::shell::make_default_shell</a>();</div>
<div class="line"><span class="comment">// Instantiare session</span></div>
<div class="line"><a class="code hl_class" href="classbs_1_1shell__session.html">bs::shell_session</a> oSession(</div>
<div class="line">    pShell.get(), <span class="comment">// Owning shell</span></div>
<div class="line">    std::cin, <span class="comment">// stdin</span></div>
<div class="line">    std::cout, <span class="comment">// stdout</span></div>
<div class="line">    std::cerr <span class="comment">// stderr</span></div>
<div class="line">);</div>
<div class="ttc" id="aclassbs_1_1shell__session_html"><div class="ttname"><a href="classbs_1_1shell__session.html">bs::shell_session</a></div><div class="ttdoc">Represents an execution environment for a shell instance.</div><div class="ttdef"><b>Definition</b> shell_session.h:57</div></div>
</div><!-- fragment --><h1><a class="anchor" id="run_command"></a>
Run a command</h1>
<p>Running a command requires instantiating the sell session and using the methods <code>shell_status shell::run(std::istream &amp;oCommand,shell_session &amp;oSession);</code>, <code>shell_status run(const std::string &amp;sCommand, shell_session &amp;oSession);</code> or <code>shell_status run(const std::string_view &amp;sCommand, shell_session &amp;oSession);</code>.</p>
<p>Example of hello world:</p>
<div class="fragment"><div class="line"><a class="code hl_enumeration" href="namespacebs.html#aec67bda13c74c2490d11e609fee6f6c9">bs::shell_status</a> run_helloworld() {</div>
<div class="line">    <span class="comment">// Generate shell</span></div>
<div class="line">    std::unique_ptr&lt;bs::shell&gt; pShell = <a class="code hl_function" href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9">bs::shell::make_default_shell</a>();</div>
<div class="line">    <span class="comment">// Instantiare session</span></div>
<div class="line">    <a class="code hl_class" href="classbs_1_1shell__session.html">bs::shell_session</a> oSession(</div>
<div class="line">        pShell.get(), <span class="comment">// Owning shell</span></div>
<div class="line">        std::cin, <span class="comment">// stdin</span></div>
<div class="line">        std::cout, <span class="comment">// stdout</span></div>
<div class="line">        std::cerr <span class="comment">// stderr</span></div>
<div class="line">    );</div>
<div class="line">    <span class="comment">// Run command</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_function" href="classbs_1_1shell.html#a985f83d5e12b5e7805e6889f6f2148b1">bs::shell::run</a>(<span class="stringliteral">&quot;echo -n &#39;Hello world!&#39;&quot;</span>sv, oSession);</div>
<div class="line">}</div>
<div class="ttc" id="aclassbs_1_1shell_html_a985f83d5e12b5e7805e6889f6f2148b1"><div class="ttname"><a href="classbs_1_1shell.html#a985f83d5e12b5e7805e6889f6f2148b1">bs::shell::run</a></div><div class="ttdeci">static shell_status run(std::istream &amp;oCommand, shell_session &amp;oSession)</div><div class="ttdoc">Runs a command or script.</div><div class="ttdef"><b>Definition</b> shell.cpp:152</div></div>
<div class="ttc" id="anamespacebs_html_aec67bda13c74c2490d11e609fee6f6c9"><div class="ttname"><a href="namespacebs.html#aec67bda13c74c2490d11e609fee6f6c9">bs::shell_status</a></div><div class="ttdeci">shell_status</div><div class="ttdoc">Shell status codes.</div><div class="ttdef"><b>Definition</b> shell_status.h:47</div></div>
</div><!-- fragment --><h1><a class="anchor" id="create_command"></a>
Create a custom command</h1>
<p>Creating a custom command requires implementing the <code><a class="el" href="classbs_1_1command.html" title="Abstract base class for all shell commands.">bs::command</a></code> interface.</p>
<p>The custom command class has to override the method <code><a class="el" href="classbs_1_1command.html#a62a67df77ffd5e49ef68523bd8c7502a" title="Execute the command.">bs::command::run</a>(const std::span&lt;const std::string&gt; &amp;, shell_session &amp;) const</code>. On success, the <code>run</code> method must return <code><a class="el" href="namespacebs.html#aec67bda13c74c2490d11e609fee6f6c9ad060b513ffc577bf5dc16b8c0815f617" title="Indicates successful execution.">bs::shell_status::SHELL_SUCCESS</a></code>. On failure, the <code>run</code> method must return <code>return bs::make_user_code(USER_ERROR_CODE)</code> (see <a class="el" href="namespacebs.html#af8e77920855beebde1c56748df546902">bs::make_user_code</a>) where <code>USER_ERROR_CODE</code> is an <code>unsigned int</code>.</p>
<p>It is recommended to define supplementary functions to print the error messages. Such functions would have a prototype like: <code>print_error(std::ostream&amp; oStderr) const</code>.</p>
<p>Use the function <code><a class="el" href="classbs_1_1shell.html#af7dc66189775130e13200d68ddb59fd2" title="Sets a command using a unique pointer. Overwrites previous command.">bs::shell::set_command</a>(std::unique_ptr&lt;command&gt; &amp;&amp;)</code> to add the custom commands. The helper template <code>template&lt;typename CommandT, typename... Args&gt; void <a class="el" href="classbs_1_1shell.html#af7dc66189775130e13200d68ddb59fd2" title="Sets a command using a unique pointer. Overwrites previous command.">bs::shell::set_command</a>(Args &amp;&amp;...)</code> may also be useful.</p>
<p>If the custom command uses a custom session, on method <code><a class="el" href="classbs_1_1command.html#a62a67df77ffd5e49ef68523bd8c7502a" title="Execute the command.">bs::command::run</a>(const std::span&lt;const std::string&gt; &amp;, shell_session &amp;) const</code>, it will be necessary to use <code>auto pCustomSession = dynamic_cast&lt;shell_session_custom*&gt;(&amp;oSession)</code> in order to acquire it.</p>
<p>If the custom command calls subshells, to prevent SIGSEGV by stack overflow it is recommended to check the shell depth. Custom commands should not modify this depth lightly.</p>
<p>Example:</p>
<div class="fragment"><div class="line"> <span class="comment">// @class command_helloworld</span></div>
<div class="line"> <span class="comment">// @brief Prints &quot;Hellow world!&quot; on stdout.</span></div>
<div class="line"> <span class="comment">// Syntax: helloworld</span></div>
<div class="line"><span class="keyword">class </span>command_helloworld : <span class="keyword">public</span> <a class="code hl_class" href="classbs_1_1command.html">bs::command</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">     <span class="comment">// @brief Constructs the command</span></div>
<div class="line">     <span class="comment">// Instantiates bs::command with the command name</span></div>
<div class="line">    command_helloworld()</div>
<div class="line">        : <a class="code hl_namespace" href="namespacebs.html">bs</a>::command(<span class="stringliteral">&quot;helloworld&quot;</span>) {</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">     <span class="comment">// @brief Prints &quot;Hellow world!&quot; on stdout</span></div>
<div class="line">     <span class="comment">// If the argument number is different from 0 then msg_error_param_number is called.</span></div>
<div class="line">     <span class="comment">// @param vArgs Command arguments</span></div>
<div class="line">     <span class="comment">// @param oSession Shell session</span></div>
<div class="line">     <span class="comment">// @return Status code</span></div>
<div class="line">    shell_status <a class="code hl_function" href="classbs_1_1command.html#a62a67df77ffd5e49ef68523bd8c7502a">run</a>(<span class="keyword">const</span> std::span&lt;const std::string&gt; &amp;vArgs, shell_session &amp;oSession)<span class="keyword"> const override </span>{</div>
<div class="line">        <span class="comment">// Check there are 0 arguments</span></div>
<div class="line">        <span class="keywordflow">if</span> (!vArgs.empty()) {</div>
<div class="line">            <span class="comment">// Call error printing functon</span></div>
<div class="line">            this-&gt;msg_error_param_number(</div>
<div class="line">                oSession.err(), <span class="comment">// stderr</span></div>
<div class="line">                vArgs.size() <span class="comment">// Argument number</span></div>
<div class="line">            );</div>
<div class="line">            <span class="comment">// Return error code 1 (make user code)</span></div>
<div class="line">            <span class="keywordflow">return</span> <a class="code hl_function" href="namespacebs.html#af8e77920855beebde1c56748df546902">bs::make_user_code</a>(1);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Print &quot;Hello World! on stdout</span></div>
<div class="line">        oSession.out() &lt;&lt; <span class="stringliteral">&quot;Hello World!&quot;</span>;</div>
<div class="line">        <span class="comment">// Return sucess code</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespacebs.html#aec67bda13c74c2490d11e609fee6f6c9ad060b513ffc577bf5dc16b8c0815f617">bs::shell_status::SHELL_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// @brief Print an error if the wrong number of arguments is provided.</span></div>
<div class="line">     <span class="comment">// @param oStdErr Stream to print error message.</span></div>
<div class="line">     <span class="comment">// @param nArgs Number of provided arguments.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> msg_error_param_number(std::ostream &amp;oStdErr, <span class="keyword">const</span> std::size_t nArgs)<span class="keyword"> const </span>{</div>
<div class="line">        <span class="comment">// Print error message</span></div>
<div class="line">        oStdErr &lt;&lt; <span class="stringliteral">&quot;helloworld: takes 0 parameters, but received &quot;</span> &lt;&lt; nArgs &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="comment">// The user may implement more complex behaviour such as internationalization</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassbs_1_1command_html"><div class="ttname"><a href="classbs_1_1command.html">bs::command</a></div><div class="ttdoc">Abstract base class for all shell commands.</div><div class="ttdef"><b>Definition</b> command.h:50</div></div>
<div class="ttc" id="aclassbs_1_1command_html_a62a67df77ffd5e49ef68523bd8c7502a"><div class="ttname"><a href="classbs_1_1command.html#a62a67df77ffd5e49ef68523bd8c7502a">bs::command::run</a></div><div class="ttdeci">virtual shell_status run(const std::span&lt; const std::string &gt; &amp;vArgs, shell_session &amp;oSession) const =0</div><div class="ttdoc">Execute the command.</div></div>
<div class="ttc" id="anamespacebs_html"><div class="ttname"><a href="namespacebs.html">bs</a></div><div class="ttdoc">BashSpark main namespace.</div><div class="ttdef"><b>Definition</b> command.h:39</div></div>
<div class="ttc" id="anamespacebs_html_aec67bda13c74c2490d11e609fee6f6c9ad060b513ffc577bf5dc16b8c0815f617"><div class="ttname"><a href="namespacebs.html#aec67bda13c74c2490d11e609fee6f6c9ad060b513ffc577bf5dc16b8c0815f617">bs::shell_status::SHELL_SUCCESS</a></div><div class="ttdeci">@ SHELL_SUCCESS</div><div class="ttdoc">Indicates successful execution.</div></div>
<div class="ttc" id="anamespacebs_html_af8e77920855beebde1c56748df546902"><div class="ttname"><a href="namespacebs.html#af8e77920855beebde1c56748df546902">bs::make_user_code</a></div><div class="ttdeci">constexpr shell_status make_user_code(const unsigned int nCode)</div><div class="ttdoc">Generates status codes for user use from user codes.</div><div class="ttdef"><b>Definition</b> shell_status.h:246</div></div>
</div><!-- fragment --><p>Example of adding it to a shell instance:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> pShell1 = <a class="code hl_function" href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9">bs::shell::make_default_shell</a>();</div>
<div class="line">pShell1-&gt;set_command&lt;command_helloworld&gt;();</div>
<div class="line"><span class="keyword">auto</span> pShell2 = <a class="code hl_function" href="classbs_1_1shell.html#af7bb333ac92bdd0b70fe3da4b22d2bc9">bs::shell::make_default_shell</a>();</div>
<div class="line"><span class="keyword">auto</span> pCommand = std::make_unique&lt;command_helloworld&gt;();</div>
<div class="line">pShell2-&gt;set_command(std::move(pCommand));</div>
</div><!-- fragment --><p>Example of shell depth check:</p>
<div class="fragment"><div class="line"><span class="comment">// Increase depth</span></div>
<div class="line"><span class="keywordflow">if</span> (!oSession.increase_shell_depth()) {</div>
<div class="line">    this-&gt;msg_error_max_depth_reached(oSession.err());</div>
<div class="line">    <span class="keywordflow">return</span> shell_status::SHELL_ERROR_MAX_DEPTH_REACHED;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Run command here</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Decrease depth</span></div>
<div class="line">oSession.decrease_shell_depth();</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
